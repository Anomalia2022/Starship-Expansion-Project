//	================================================================================
//	2023 Realism Overhaul - General patches
//	================================================================================



@PART[SEP_*]:AFTER[StarshipExpansionProject]:NEEDS[RealismOverhaul]
{
	%RSSROConfig = True
}

@PART[SEP_23_BOOSTER_INTEGRATED|SEP_23_SHIP_CARGO|SEP_23_SHIP_TANKER|SEP_23_SHIP_CREW|SEP_23_SHIP_DEPOT|SEP_23_SHIP_CARGO_EXP|SEP_23_SHIP_NOSE_EXP]:AFTER[zzzRealismOverhaul]
{
	@MODULE[ModuleEngines*],*
	{
		@name = ModuleEnginesFX
	}
}



//	================================================================================
//	2023 SuperHeavy patches
//	================================================================================



@PART[SEP_23_BOOSTER_*]:AFTER[StarshipExpansionProject]:NEEDS[RealismOverhaul]
{
	@manufacturer = SpaceX
	@tags = SpaceX, Starship, SuperHeavy, Booster

	MODULE
	{
		name = ModuleAeroReentry
		leaveTemp = true
		skinMaxOperationalTemp = 973.15
	}
}

@PART[SEP_23_BOOSTER_INTEGRATED]:AFTER[StarshipExpansionProject]:NEEDS[RealismOverhaul]
{
	@title = Super Heavy Core
	@description = This massive fuel tank have all the fuel needed for your SuperHeavy booster.

	!MODULE[ModuleFuelTanks],* {}

	MODULE
	{
		name = ModuleFuelTanks
		volume = 4080108
		type = Tank-Sep-Starship
		basemass = -1
		TANK
		{
			name = LqdMethane
			amount = Full
			maxAmount = 43.0%
		}
		TANK
		{
			name = LqdOxygen
			amount = Full
			maxAmount = 57.0%
		}
	}
}

@PART[SEP_23_BOOSTER_CLUSTER]:AFTER[StarshipExpansionProject]:NEEDS[RealismOverhaul]
{
	!MODULE[ModuleAlternator],* {}

	@title = Super Heavy Raptor Cluster
	@description = This powerful cluster of raptor engines is responsible for lifting a starship stack and returning itself for rapid reusability.
	@angularDrag = 0
    %bodyLiftMultiplier = 0.1

	@MODULE[ModuleEngine*]
	{
		%EngineType = LiquidFuel
	}

	MODULE
	{
		name = ModuleEngineConfigs
		type = ModuleEngines
		configuration = All Raptors
		modded = false
		engineID = AllEngines

		CONFIG
		{
			name = All Raptors
			heatProduction = 100
			throttleResponseRate = 0.625
			PROPELLANT // Ratio = 3.55
			{
				name = LqdMethane
				ratio = 0.43
				DrawGauge = true
			}
			PROPELLANT
			{
				name = LqdOxygen
				ratio = 0.57
			}
			atmosphereCurve
			{
				key = 0 350
				key = 1 325
			}

			ullage = True
			pressureFed = False
			ignitions = 0
			gimbalRange = 15

			IGNITOR_RESOURCE
			{
				name = ElectricCharge
				amount = 1.0
			}
			IGNITOR_RESOURCE // Torch-Lit System uses the same propellant has the engines [5]
			{
				name = LqdMethane
				amount = 0.43 // ~ Guess
			}
			IGNITOR_RESOURCE // Torch-Lit System uses the same propellant has the engines [5]
			{
				name = LqdOxygen
				amount = 0.57 // ~ Guess
			}

			massMult = 1.0
		}
	}

	MODULE
	{
		name = ModuleEngineConfigs
		type = ModuleEngines
		configuration = 10 Raptors
		modded = false
		engineID = MiddleInner

		CONFIG
		{
			name = 10 Raptors
			heatProduction = 100
			throttleResponseRate = 0.625
			PROPELLANT // Ratio = 3.55
			{
				name = LqdMethane
				ratio = 0.43
				DrawGauge = true
			}
			PROPELLANT
			{
				name = LqdOxygen
				ratio = 0.57
			}
			atmosphereCurve
			{
				key = 0 350
				key = 1 325
			}

			ullage = True
			pressureFed = False
			ignitions = 0
			gimbalRange = 15

			IGNITOR_RESOURCE
			{
				name = ElectricCharge
				amount = 1.0
			}
			IGNITOR_RESOURCE // Torch-Lit System uses the same propellant has the engines [5]
			{
				name = LqdMethane
				amount = 0.43 // ~ Guess
			}
			IGNITOR_RESOURCE // Torch-Lit System uses the same propellant has the engines [5]
			{
				name = LqdOxygen
				amount = 0.57 // ~ Guess
			}

			massMult = 1.0
		}
	}

	MODULE:NEEDS[TundraExploration]
	{
		name = ModuleEngineConfigs
		type = ModuleEngines
		configuration = 3 Raptors
		modded = false
		engineID = CenterThree

		CONFIG
		{
			name = 3 Raptors
			heatProduction = 100
			throttleResponseRate = 0.625
			PROPELLANT // Ratio = 3.55
			{
				name = LqdMethane
				ratio = 0.43
				DrawGauge = true
			}
			PROPELLANT
			{
				name = LqdOxygen
				ratio = 0.57
			}
			atmosphereCurve
			{
				key = 0 350
				key = 1 325
			}

			ullage = True
			pressureFed = False
			ignitions = 0
			gimbalRange = 15

			IGNITOR_RESOURCE
			{
				name = ElectricCharge
				amount = 1.0
			}
			IGNITOR_RESOURCE // Torch-Lit System uses the same propellant has the engines [5]
			{
				name = LqdMethane
				amount = 0.43 // ~ Guess
			}
			IGNITOR_RESOURCE // Torch-Lit System uses the same propellant has the engines [5]
			{
				name = LqdOxygen
				amount = 0.57 // ~ Guess
			}

			massMult = 1.0
		}
	}

	@MODULE[ModuleSEPEngineGUI]
	{
		@RBCoverMass = 16.5
		@SingleEngineThrust = 2255
		@SingleEngineMass = 1.5
		%SingleMinEngineThrust = 721
	}
}

@PART[SEP_23_BOOSTER_GRIDFIN]:AFTER[StarshipExpansionProject]:NEEDS[RealismOverhaul]
{
	@title = Super Heavy Grid fin
	@description = This isn't a big waffle, but a powerfull tool to keep your big booster on course through reentry and landing
}



//	================================================================================
//	2023 Ship patches
//	================================================================================



@PART[SEP_23_SHIP_*]:AFTER[StarshipExpansionProject]:NEEDS[RealismOverhaul]
{
	!MODULE[ModuleInventoryPart],* {}
	!MODULE[ModuleFuelTanks],* {}

	@manufacturer = SpaceX
	@tags = SpaceX, Starship, Mars

	MODULE
	{
		name = ModuleAeroReentry
		leaveTemp = true
		skinMaxOperationalTemp = 2773.15
	}
}

@PART[SEP_23_SHIP_CREW|SEP_23_SHIP_CARGO|SEP_23_SHIP_NOSE_EXP|SEP_23_SHIP_CARGO_EXP]:AFTER[StarshipExpansionProject]:NEEDS[RealismOverhaul]
{
	MODULE
	{
		name = ModuleFuelTanks
		type = ServiceModule
		volume = 533
		basemass = -1
		TANK
		{
			name = ElectricCharge
			amount = Full
			maxAmount = 100%
		}
	}
}

@PART[SEP_23_SHIP_CREW]:AFTER[StarshipExpansionProject]:NEEDS[RealismOverhaul]
{
	@title = Starship Crew Module
	@description = This huge command pod can carry crew and cargo on long, interplanetary missions.

	@MODULE[ModuleScienceContainer]
	{
		@evaOnlyStorage = False
	}

	MODULE:NEEDS[KIS]
	{
		name = ModuleKISInventory
		maxVolume = 20000
		externalAccess = false
		internalAccess = true
		slotsX = 8
		slotsY = 4
		slotSize = 50
		itemIconResolution = 128
		selfIconResolution = 128
		openSndPath = KIS/Sounds/containerOpen
		closeSndPath = KIS/Sounds/containerClose
		defaultMoveSndPath = KIS/Sounds/itemMove
	}
}

@PART[SEP_23_SHIP_CARGO]:AFTER[StarshipExpansionProject]:NEEDS[RealismOverhaul]
{
	@title = Starship Cargo Module
	@description = This Module can carry cargo or Satellites. Perfect for your LEO Heavy Cargo needs.
}


@PART[SEP_23_SHIP_TANKER]:AFTER[StarshipExpansionProject]:NEEDS[RealismOverhaul]
{
	@title = Starship Tanker Module
	@description = This Module carry fuel for your refueling missions. Probably will be your most used module.

	@RESOURCE[ElectricCharge]
	{
		@amount = 533000
		@maxAmount = 533000
	}

	MODULE
	{
		name = ModuleFuelTanks
		volume = 123692
		type = Tank-Sep-Starship
		basemass = -1
		TANK
		{
			name = LqdMethane
			amount = Full
			maxAmount = 43.0%
		}
		TANK
		{
			name = LqdOxygen
			amount = Full
			maxAmount = 57.0%
		}
	}
}

@PART[SEP_23_SHIP_HEADER]:AFTER[StarshipExpansionProject]:NEEDS[RealismOverhaul]
{
	@title = Starship Header Tank
	@description = This small tank sits perfectly on the nose. A perfect source of fuel for landing burns.

	MODULE
	{
		name = ModuleFuelTanks
		volume = 33607.2
		type = Tank-Sep-Starship
		basemass = -1
		TANK
		{
			name = LqdMethane
			amount = Full
			maxAmount = 43.0%
		}
		TANK
		{
			name = LqdOxygen
			amount = Full
			maxAmount = 57.0%
		}
	}
}

@PART[SEP_23_SHIP_BODY]:AFTER[StarshipExpansionProject]:NEEDS[RealismOverhaul]
{
	@title = Starship Core
	@description = This massive insulated fuel tank is designed to contain Starship's propellant for long interplanetary voyages. Shielding protects its content from the forces of reentry and also provides RCS thrust.
	%radiatorHeadroom = 0.5

	MODULE
	{
		name = ModuleActiveRadiator
		maxEnergyTransfer = 50000
		overcoolFactor = 0.0186367
		isCoreRadiator = true
		RESOURCE
		{
			name = ElectricCharge
			rate = 0.500
		}
	}

	MODULE
	{
		name = ModuleFuelTanks
		volume = 1454632.3
		type = Tank-Sep-Starship
		basemass = -1
		TANK
		{
			name = LqdMethane
			amount = Full
			maxAmount = 43.0%
		}
		TANK
		{
			name = LqdOxygen
			amount = Full
			maxAmount = 57.0%
		}
	}
}

@PART[SEP_23_SHIP_FWD_LEFT]:AFTER[StarshipExpansionProject]:NEEDS[RealismOverhaul]
{
	@title = Starship Front Left Flap
	@description = The Front Flap is not, and does not behave like typical control surface. Its purpose is always to hold a set trim and influence airflow around Starship while aerobraking.
}
@PART[SEP_23_SHIP_FWD_RIGHT]:AFTER[StarshipExpansionProject]:NEEDS[RealismOverhaul]
{
	@title = Starship Front Right Flap
	@description = The Front Flap is not, and does not behave like typical control surface. Its purpose is always to hold a set trim and influence airflow around Starship while aerobraking.
}

@PART[SEP_23_SHIP_AFT_LEFT]:AFTER[StarshipExpansionProject]:NEEDS[RealismOverhaul]
{
	@title = Starship Rear Left Flap
	@description = Inspired by aircaft control surfaces, this Actuating Wing allows pitch and roll control primarily during aerobraking.
}
@PART[SEP_23_SHIP_AFT_RIGHT]:AFTER[StarshipExpansionProject]:NEEDS[RealismOverhaul]
{
	@title = Starship Rear Right Flap
	@description = Inspired by aircaft control surfaces, this Actuating Wing allows pitch and roll control primarily during aerobraking.
}

@PART[SEP_23_SHIP_BODY_EXP]:AFTER[StarshipExpansionProject]:NEEDS[RealismOverhaul]
{
	@title = Starship Core Expendable
	@description = This massive insulated fuel tank is designed to contain Starship's propellant for long interplanetary voyages. Shielding protects its content from the forces of reentry and also provides RCS thrust.
	%radiatorHeadroom = 0.5

	MODULE
	{
		name = ModuleActiveRadiator
		maxEnergyTransfer = 50000
		overcoolFactor = 0.0186367
		isCoreRadiator = true
		RESOURCE
		{
			name = ElectricCharge
			rate = 0.500
		}
	}

	MODULE
	{
		name = ModuleFuelTanks
		volume = 1454632.3
		type = Tank-Sep-Starship
		basemass = -1
		TANK
		{
			name = LqdMethane
			amount = Full
			maxAmount = 43.0%
		}
		TANK
		{
			name = LqdOxygen
			amount = Full
			maxAmount = 57.0%
		}
	}
}

@PART[SEP_23_SHIP_NOSE_EXP]:AFTER[StarshipExpansionProject]:NEEDS[RealismOverhaul]
{
	@title = Starship Expendable Nosecone Module
	@description = This Module can carry absolutely nothing. Perfect for throwing money out
}


@PART[SEP_23_SHIP_CARGO_EXP]:AFTER[StarshipExpansionProject]:NEEDS[RealismOverhaul]
{
	@title = Starship Cargo Module
	@description = This Module can carry cargo or Satellites. Perfect for your LEO Heavy Cargo needs.
}

@PART[SEP_23_SHIP_DEPOT]:AFTER[StarshipExpansionProject]:NEEDS[RealismOverhaul]
{
	@title = Starship Cargo Module
	@description = This Module can carry cargo or Satellites. Perfect for your LEO Heavy Cargo needs.

	MODULE
	{
		name = ModuleActiveRadiator
		maxEnergyTransfer = 50000
		overcoolFactor = 0.0186367
		isCoreRadiator = true
		RESOURCE
		{
			name = ElectricCharge
			rate = 0.500
		}
	}

	// 13 rings including domes = 1454632.3 so assuming it's 22rings 22 = 2461685.43
	MODULE
	{
		name = ModuleFuelTanks
		volume = 2461685.43
		type = Tank-Sep-Starship
		basemass = -1
		TANK
		{
			name = LqdMethane
			amount = 59.0%
			maxAmount = 43.0%
		}
		TANK
		{
			name = LqdOxygen
			amount = 59.0%
			maxAmount = 57.0%
		}
	}
}

@PART[SEP_23_SHIP_CARGO|SEP_23_SHIP_TANKER|SEP_23_SHIP_CREW|SEP_23_SHIP_DEPOT|SEP_23_SHIP_CARGO_EXP|SEP_23_SHIP_NOSE_EXP]:BEFORE[RealAntennas]
{
	!MODULE[ModuleDataTransmitter],* {}

	MODULE
	{
		name = ModuleRealAntenna
		referenceGain = 1.5
		RFBand = UHF	//Default to UHF-band
	}

	MODULE
	{
		name = ModuleRealAntenna
		antennaDiameter = 0.8
		RFBand = S	//Default to S-band
	}
}



//	================================================================================
//	2023 Raptor patches
//	================================================================================



@PART[SEP_23_RAPTOR2_*]:AFTER[StarshipExpansionProject]:NEEDS[RealismOverhaul]
{
    %TechRequired = stagedCombustionNF
    %cost = 0
    %entryCost = 60000
    RP0conf = true

    !MODULE[ModuleEngineConfigs],*{}
	!MODULE[ModuleAlternator],*{}
	!RESOURCE,*{}

    MODULE
    { name = ModuleTagEngineLiquidTurbo }

    @MODULE[ModuleEngine*]
	{
		%EngineType = LiquidFuel
	}
}

@PART[SEP_23_RAPTOR2_SL_RC]:AFTER[StarshipExpansionProject]:NEEDS[RealismOverhaul]
{
	@title = Raptor Center (Sea Level)
    @description ^=:$: <b><color=green>From Starship Expansion Project mod</color></b>

	@MODULE[ModuleGimbal]
	{
		%gimbalRangeXP = 15
		%gimbalRangeXN = 15
		%useGimbalResponseSpeed = true
		%gimbalResponseSpeed = 16
	}

	MODULE
	{
		name = ModuleEngineConfigs
		type = ModuleEngines
		configuration = Raptor 2
		modded = false
		origMass = 2

		CONFIG
		{
			name = Raptor 2
			maxThrust = 2255
			minThrust = 721
			heatProduction = 100
			ratedBurnTime = 1800
			throttleResponseRate = 0.625
			PROPELLANT // Ratio = 3.55
			{
				name = LqdMethane
				ratio = 0.43
				DrawGauge = true
			}
			PROPELLANT
			{
				name = LqdOxygen
				ratio = 0.57
			}
			atmosphereCurve
			{
				key = 0 350
				key = 1 325
			}

			ullage = True
			pressureFed = False
			ignitions = 0

			IGNITOR_RESOURCE
			{
				name = ElectricCharge
				amount = 1.0
			}
			IGNITOR_RESOURCE // Torch-Lit System uses the same propellant has the engines [5]
			{
				name = LqdMethane
				amount = 0.43 // ~ Guess
			}
			IGNITOR_RESOURCE // Torch-Lit System uses the same propellant has the engines [5]
			{
				name = LqdOxygen
				amount = 0.57 // ~ Guess
			}

			massMult = 1
		}
	}
}

@PART[SEP_23_RAPTOR2_SL_RB]:AFTER[StarshipExpansionProject]:NEEDS[RealismOverhaul]
{
	@title = Raptor Booster (Sea Level)
    @description ^=:$: <b><color=green>From Starship Expansion Project mod</color></b>

	MODULE
	{
		name = ModuleEngineConfigs
		type = ModuleEngines
		configuration = Raptor 2 Booster
		modded = false
		origMass = 1.5

		CONFIG
		{
			name = Raptor 2 Booster
			maxThrust = 2255
			minThrust = 721
			heatProduction = 100
			ratedBurnTime = 1800
			throttleResponseRate = 0.625
			PROPELLANT // Ratio = 3.55
			{
				name = LqdMethane
				ratio = 0.43
				DrawGauge = true
			}
			PROPELLANT
			{
				name = LqdOxygen
				ratio = 0.57
			}
			atmosphereCurve
			{
				key = 0 350
				key = 1 325
			}

			ullage = True
			pressureFed = False
			ignitions = 0
			gimbalRange = 0

			IGNITOR_RESOURCE
			{
				name = ElectricCharge
				amount = 1.0
			}
			IGNITOR_RESOURCE // Torch-Lit System uses the same propellant has the engines [5]
			{
				name = LqdMethane
				amount = 0.43 // ~ Guess
			}
			IGNITOR_RESOURCE // Torch-Lit System uses the same propellant has the engines [5]
			{
				name = LqdOxygen
				amount = 0.57 // ~ Guess
			}

			massMult = 1
		}
	}
}

@PART[SEP_23_RAPTOR_VAC]:AFTER[StarshipExpansionProject]:NEEDS[RealismOverhaul]
{
	@title = Raptor (Vacuum)
    @description ^=:$: <b><color=green>From Starship Expansion Project mod</color></b>

	MODULE
	{
		name = ModuleEngineConfigs
		type = ModuleEngines
		configuration = Raptor Vacuum
		modded = false
		origMass = 1.5

		CONFIG
		{
			name = Raptor Vacuum
			maxThrust = 2255
			minThrust = 721
			heatProduction = 100
			ratedBurnTime = 3600
			throttleResponseRate = 0.625
			PROPELLANT // Ratio = 3.55
			{
				name = LqdMethane
				ratio = 0.43
				DrawGauge = true
			}
			PROPELLANT
			{
				name = LqdOxygen
				ratio = 0.57
			}
			atmosphereCurve
			{
				key = 0 378
				key = 1 240 // ~ Guess
			}

			ullage = True
			pressureFed = False
			ignitions = 0
			gimbalRange = 0

			IGNITOR_RESOURCE
			{
				name = ElectricCharge
				amount = 1.0
			}
			IGNITOR_RESOURCE // Torch-Lit System uses the same propellant has the engines [5]
			{
				name = LqdMethane
				amount = 0.43 // ~ Guess
			}
			IGNITOR_RESOURCE // Torch-Lit System uses the same propellant has the engines [5]
			{
				name = LqdOxygen
				amount = 0.57 // ~ Guess
			}

			massMult = 1.25 // ~ Guess
		}
	}
}

@PART[SEP_23_RAPTOR2_SL_RC|SEP_23_RAPTOR2_SL_RB]:BEFORE[zTestFlight]
{
	TESTFLIGHT
	{
		name = Raptor
		ratedBurnTime = 1800 // ~ Guess to Allow it to Burn For 30 Minutes
		ignitionReliabilityStart = 0.98 // ~ Slight Chance of the Torch-lit system failing
		ignitionReliabilityEnd = 0.995 // ~ Slight Chance of the Torch-lit system failing
		cycleReliabilityStart = 0.99975
		cycleReliabilityEnd = 0.99995
	}
}

@PART[SEP_23_RAPTOR_VAC]:BEFORE[zTestFlight]
{
	TESTFLIGHT
	{
		name = Raptor Vacuum
		ratedBurnTime = 3600 // ~ Guess to Allow it to Burn For 1 Hour
		ignitionReliabilityStart = 0.98 // ~ Slight Chance of the Torch-lit system failing
		ignitionReliabilityEnd = 0.995 // ~ Slight Chance of the Torch-lit system failing
		cycleReliabilityStart = 0.99975
		cycleReliabilityEnd = 0.99995
	}
}